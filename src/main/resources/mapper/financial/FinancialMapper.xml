<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zihui.cwoa.financial.dao.FinancialMapper" >

  <select id="queryProjectAllInAndOut" resultType="com.zihui.cwoa.financial.pojo.ProjectInAndOut">
    SELECT user_project AS project_name,SUM(flow_money_out) AS all_out,SUM(flow_money_in) AS all_in
    FROM fin_money_flow GROUP BY user_project
  </select>

  <select id="queryProjectMonthInAndOut" parameterType="String" resultType="com.zihui.cwoa.financial.pojo.ProjectMonthInAndOut">
   SELECT user_project AS project_name,SUM(flow_money_out) AS all_out,SUM(flow_money_in) AS all_in,
   flow_year,flow_month FROM fin_money_flow WHERE user_project=#{project_name} GROUP BY flow_year,flow_month
   ORDER BY flow_year DESC,flow_month DESC
  </select>

  <select id="queryProjectMonthOutDetail" parameterType="String" resultType="com.zihui.cwoa.financial.pojo.ProjectMonthDetail">
    SELECT tableone.*,user_name FROM
    (SELECT user_project AS project_name,flow_money_out,flow_year,flow_month,flow_date,user_code,flow_process_id,flow_type
    FROM fin_money_flow WHERE  user_project=#{arg0} AND flow_year=#{arg1} AND flow_month=#{arg2}
    AND flow_money_out IS NOT NULL ) tableone
    LEFT JOIN sys_user su ON su.user_code=tableone.user_code ORDER BY flow_date DESC
  </select>

  <select id="queryProjectMonthInDetail" parameterType="String" resultType="com.zihui.cwoa.financial.pojo.ProjectMonthDetail">
    SELECT tableone.*,user_name FROM
    (SELECT user_project AS project_name,flow_money_in,flow_year,flow_month,flow_date,user_code,flow_process_id,flow_type
    FROM fin_money_flow WHERE  user_project=#{arg0} AND flow_year=#{arg1} AND flow_month=#{arg2}
    AND flow_money_in IS NOT NULL) tableone
    LEFT JOIN sys_user su ON su.user_code=tableone.user_code ORDER BY flow_date DESC
  </select>

  <select id="queryProjectAllIn" resultType="com.zihui.cwoa.financial.pojo.ProjectInAndOut">
    SELECT user_project AS project_name,SUM(flow_money_in) AS all_in
    FROM fin_pro_money_flow GROUP BY user_project
  </select>

  <select id="queryProjectMonthIn" parameterType="String" resultType="com.zihui.cwoa.financial.pojo.ProjectMonthInAndOut">
    SELECT user_project AS project_name,SUM(flow_money_in) AS all_in,
    flow_year,flow_month FROM fin_pro_money_flow WHERE user_project=#{project_name} GROUP BY flow_year,flow_month
    ORDER BY flow_year DESC,flow_month DESC
  </select>

  <select id="queryProMonthInDetail" parameterType="String" resultType="com.zihui.cwoa.financial.pojo.ProjectMonthDetail">
    SELECT tableone.*,user_name FROM
    (SELECT user_project AS project_name,flow_money_in,flow_year,flow_month,flow_date,user_code,flow_process_id,flow_type
    FROM fin_pro_money_flow WHERE  user_project=#{arg0} AND flow_year=#{arg1} AND flow_month=#{arg2}
    AND flow_money_in IS NOT NULL) tableone
    LEFT JOIN sys_user su ON su.user_code=tableone.user_code ORDER BY flow_date DESC
  </select>

  <select id="queryMoneyFlowByVoc" parameterType="String" resultType="com.zihui.cwoa.financial.pojo.ProjectMonthDetail">
    SELECT tableone.*,user_name FROM
    (SELECT user_code,user_project AS project_name,flow_year,flow_month,flow_date,
    IFNULL(flow_money_out,0) AS flow_money_out,IFNULL(flow_money_in,0) AS flow_money_in,flow_type,flow_process_id
    FROM fin_money_flow WHERE  1=1
    <if test="arg0!=null and arg0!=''"> and  user_code=#{arg0}</if>
    <if test="arg1!=null and arg1!=''"> and  user_project=#{arg1}</if>
    <if test="arg2!=null and arg2!=''"> and  flow_year=#{arg2}</if>
    <if test="arg3!=null and arg3!=''"> and  flow_month=#{arg3}</if>
    <if test="arg4!=null and arg4!=''"> and  flow_type=#{arg4}</if>
    LIMIT #{arg5},#{arg6}) tableone
    LEFT JOIN sys_user su ON su.user_code=tableone.user_code
  </select>

  <select id="countMoneyFlowByVoc" parameterType="String" resultType="Integer">
    SELECT COUNT(flow_id)
    FROM fin_money_flow WHERE  1=1
    <if test="arg0!=null and arg0!=''"> and  user_code=#{arg0}</if>
    <if test="arg1!=null and arg1!=''"> and  user_project=#{arg1}</if>
    <if test="arg2!=null and arg2!=''"> and  flow_year=#{arg2}</if>
    <if test="arg3!=null and arg3!=''"> and  flow_month=#{arg3}</if>
    <if test="arg4!=null and arg4!=''"> and  flow_type=#{arg4}</if>
  </select>

  <select id="queryMoneyFlowByVop" parameterType="String" resultType="com.zihui.cwoa.financial.pojo.ProjectMonthDetail">
    SELECT tableone.*,user_name FROM
    (SELECT user_code,user_project AS project_name,flow_year,flow_month,flow_date,0 AS flow_money_out,
    IFNULL(flow_money_in,0) AS flow_money_in,flow_type,flow_process_id
    FROM fin_pro_money_flow WHERE  1=1
    <if test="arg0!=null and arg0!=''"> and  user_code=#{arg0}</if>
    <if test="arg1!=null and arg1!=''"> and  user_project=#{arg1}</if>
    <if test="arg2!=null and arg2!=''"> and  flow_year=#{arg2}</if>
    <if test="arg3!=null and arg3!=''"> and  flow_month=#{arg3}</if>
    <if test="arg4!=null and arg4!=''"> and  flow_type=#{arg4}</if>
    LIMIT #{arg5},#{arg6}) tableone
    LEFT JOIN sys_user su ON su.user_code=tableone.user_code
  </select>

  <select id="countMoneyFlowByVop" parameterType="String" resultType="Integer">
    SELECT COUNT(flow_id)
    FROM fin_pro_money_flow WHERE  1=1
    <if test="arg0!=null and arg0!=''"> and  user_code=#{arg0}</if>
    <if test="arg1!=null and arg1!=''"> and  user_project=#{arg1}</if>
    <if test="arg2!=null and arg2!=''"> and  flow_year=#{arg2}</if>
    <if test="arg3!=null and arg3!=''"> and  flow_month=#{arg3}</if>
    <if test="arg4!=null and arg4!=''"> and  flow_type=#{arg4}</if>
  </select>
</mapper>