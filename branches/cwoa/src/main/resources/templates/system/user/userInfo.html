<!DOCTYPE html>

<html>

	<head>
		<meta charset="utf-8" />
		<title>设置我的资料</title>
		<meta name="renderer" content="webkit" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0" />
		<link rel="stylesheet" href="../../../static/css/admin.css" media="all" />
		<link rel="stylesheet" href="../../../static/layui/css/layui.css" media="all" />
		<style type="text/css">
			.layui-col-md3 {
				width: 110px;
			}
			
			.layui-col-md4 {
				width: 190px;
			}
			
			.layui-col-md5 {
				width: 100px;
				margin-top: 40px;
				margin-left: 75px;
			}
			
			.box .layui-input-inline {
				margin-left: 5px;
			}
		</style>
	</head>

	<body>

		<div class="layui-fluid">
			<div class="layui-row layui-col-space15">
				<div class="layui-col-md12">
					<div class="layui-card">
						<div class="layui-card-header">设置我的资料</div>
						<div class="layui-card-body" pad15>
							<div class="layui-form" lay-filter="">
								<div class="layui-form-item">
									<label class="layui-form-label">用户工号</label>
									<div class="layui-input-inline">
										<input type="text" id="LAY-user-login-code" readonly="readonly" class="layui-input" />
									</div>
								</div>

								<div class="layui-form-item">
									<label class="layui-form-label">用户名</label>
									<div class="layui-input-inline">
										<input type="text" id="username" lay-verify="nickname" class="layui-input" />
									</div>
								</div>
								<div class="layui-form-item">
									<label class="layui-form-label">头像</label>
									<div class="layui-input-inline">
										<img class="layui-upload-img" id="demo1" style="width: 100px; height: 100px;">
										 <p id="demoText"></p>
									</div>
									<div class="layui-input-inline layui-btn-container" style="width: auto; margin-top: 30px;">
										<button type="button" class="layui-btn layui-btn-primary" id="test1">
                    						<i class="layui-icon"></i>上传图片
                  							</button>
									</div>
								</div>
								<div class="layui-form-item">
									<label class="layui-form-label">性别</label>
									<div class="layui-input-block">
										<input type="radio" name="sex" value="男" title="男" />
										<input type="radio" name="sex" value="女" title="女" checked="checked" />
									</div>
								</div>

								

								<div class="layui-form-item">
									<label class="layui-form-label">手机号</label>
									<div class="layui-input-inline">
										<input type="text" id="cellphone" value="" lay-verify="phone" autocomplete="off" class="layui-input" />
									</div>
								</div>
								<div class="layui-form-item">
									<label class="layui-form-label">邮箱</label>
									<div class="layui-input-inline">
										<input type="text" name="email" value="" lay-verify="email" autocomplete="off" class="layui-input" />
									</div>
								</div>
								<div class="layui-form-item">
									<div class="layui-input-block">
										<button id="tijiao" class="layui-btn" lay-submit="" lay-filter="setmyinfo">确认修改</button>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script src="../../../static/layui/layui.js"></script>
		<script>
			layui.extend({

				inputverify: "../../../static/js/common/inputverify",
				setter: "../../../static/layui/config"

			}).use(['upload', "form", "inputverify", "setter"], function() {
				var form = layui.form, //只有执行了这一步，部分表单元素才会自动修饰成功
					$ = layui.jquery,
					upload = layui.upload;
					console.log(layui.setter.project);
					var filename = "";
					//普通图片上传
					var uploadInst = upload.render({
					elem: '#test1',
					url: layui.setter.project + '/file/upload',
					data: {
						filetype: "TX"
					},
					auto: false, //选择文件后不自动上传
					accept: 'images',//校验的文件类型
					acceptMime: 'image/*',//规定打开文件选择框时，筛选出的文件类型
					size: '5000',//5m 单位 KB
					bindAction: '#tijiao', //指向一个按钮触发上传
					choose: function(obj){//选择文件后的回调函数
						//预读本地文件示例，不支持ie8
						obj.preview(function(index, file, result) {
							$('#demo1').attr('src', result); //图片链接（base64）
						});
					},
					before: function(obj) {//文件上传前的回调函数
						
						
					},
					done: function(res) {
						console.log(res)

						if(res.result == 200) {
							filename = res.map.filename;
							console.log(filename);
						}
						//上传成功
					},
					error: function() {
						//演示失败状态，并实现重传
						var demoText = $('#demoText');
						demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
						demoText.find('.demo-reload').on('click', function() {
							uploadInst.upload();
						});
					}
				});

				//监听提交按钮
				form.on('submit(setmyinfo)', function(data) {
					
					
					setTimeout(function () {
						var usercode = $("#LAY-user-login-code").val();
						var username = $("#username").val();
						var age = $("#age").val();
						var images = filename;
						var cellphone = $("#cellphone").val();
						var item = $("input[name='sex']:checked").val();
						console.log("进入ajax"+filename);
                   		$.ajax({
						url: layui.setter.project + "/user/userinfo",
						type: "post",
						xhrFields: {
							withCredentials: true
						},
						data: {
							"userCode": usercode,
							"userName": username,
							"images": images,
							"phone": cellphone,
							"sex": item
						},
						//contentType:"application/json",
						dataType: "json",
						success: function(data) {
							if(data.result == 200) {
								layer.msg(data.message);
								form.render();
							} else {
								layer.msg(data.message);
								form.render();
							}
						}
					});
                   	},1000);
					
					
					
					
				});

				

			});
		</script>
	</body>

</html>