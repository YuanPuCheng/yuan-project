<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8" />
		<title>出差申请</title>
		<meta name="renderer" content="webkit" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" href="../../static/css/reset.css" />
		<link rel="stylesheet" href="./../../static/layui/css/layui.css" />
		<style type="text/css">
			#go {
				width: 150px;
				height: 40px;
				background-color: #009688;
				line-height: 40px;
				text-align: center;
				color: #fff;
				margin-left: 25px;
			}
			
			#go:hover {
				cursor: pointer;
			}
			
			.layui-input,
			.layui-textarea {
				width: 99%;
			}
		</style>
	</head>

	<body>
		<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
			<legend style="font-size: 30px;font-weight: 500;">出差申请</legend>
		</fieldset>
		<form class="layui-form" action="">
			<div class="layui-form-item">
				<label class="layui-form-label">出差人：</label>
				<div class="layui-input-block">
					<input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入姓名..." class="layui-input" id='username' disabled="disabled" />
				</div>
			</div>
			<div class="layui-form-item">
				<label class="layui-form-label">所在部门：</label>
				<div class="layui-input-block">
					<input type="text" name="username" lay-verify="required" placeholder="现所在部门..." autocomplete="off" class="layui-input" id='department' disabled="disabled" />
				</div>
			</div>
			<div class="layui-form-item">
				<label class="layui-form-label">所在项目：</label>
				<div class="layui-input-block">
					<input type="text" name="username" lay-verify="required" placeholder="现在正在负责的项目..." autocomplete="off" class="layui-input" id='project' disabled="disabled" />
				</div>
			</div>
			<div class="layui-form-item">
				<label class="layui-form-label">开始日期：</label>
				<div class="layui-input-block">
					<input type="text" class="layui-input" id="test16" placeholder="请假开始日期..." />
				</div>
			</div>
			<div class="layui-form-item">
				<label class="layui-form-label">结束日期：</label>
				<div class="layui-input-block">
					<input type="text" class="layui-input" id="test17" placeholder="请假结束日期..." />
				</div>
			</div>
			<div class="layui-form-item layui-form-text">
				<label class="layui-form-label">出差描述：</label>
				<div class="layui-input-block">
					<textarea placeholder="请输入内容" class="layui-textarea" id='reason'></textarea>
				</div>
			</div>
			<div class="layui-form-item">
				<div class="layui-input-block">
					<div id="go">点击提交</div>
				</div>
			</div>
		</form>

		<script src="./../../static/layui/layui.js"></script>
		<script>
			//<![CDATA[
			layui.use(['layer', 'laydate'], function() {
				var laydate = layui.laydate;
				var $ = layui.jquery;
				var layer = layui.layer;
				var click = false;
				laydate.render({
					elem: '#test16',
					type: 'date',
					format: 'yyyy.MM.dd'
				});
				laydate.render({
					elem: '#test17',
					type: 'date',
					format: 'yyyy.MM.dd'
				});
				$(document).ready(function() {
					$('#username').val($("#uName",parent.document).attr("name"));
					$('#department').val($("#uDepartment",parent.document).attr("name"));
					$('#project').val($("#uProject",parent.document).attr("name"));
				});
				$("#go").click(function() {
					if(!click) {
						click = true;
						var userCode=$("#uCode",parent.document).attr("name");
						var name = $('#username').val();
						var department = $('#department').val();
						var project = $('#project').val();
						var timeone = $('#test16').val();
						var timetwo = $('#test17').val();
						var time = timeone + "至" + timetwo;
						var dayone = new Date(timeone); 　　
						var daytwo = new Date(timetwo); 　　
						var days = daytwo.getTime() - dayone.getTime(); 　　
						var leavedays = parseInt(days / (1000 * 60 * 60 * 24)) + 1;
						var reason = $('#reason').val();
						if(isNaN(leavedays)) {
							layer.msg('请选择正确的出差日期！');
							return;
						} else if(leavedays <= 0) {
							layer.msg('请选择正确的出差日期！');
							return;
						}
						if(reason == "") {
							layer.msg('请输入出差描述！');
							return;
						}
						var jsonTest = {
							"userName": name,
							"userDepartment": department,
							"userProject": project,
							"leavedays": leavedays, //根据用户输入的日期计算得到
							"userCode":userCode,
							"processSummary": [{
									"indexName": "出差时间",
									"indexValue": time
								},
								{
									"indexName": "出差描述",
									"indexValue": reason
								}
							]
						};
						$.ajax({
							url: "/process/askforbusiness",
							type: "post", //post请求
							data: JSON.stringify(jsonTest), //这里发送的数据必须得是Json格式的字符串
							contentType: "application/json", //告诉服务端你发送的是json数据
							dataType: "text", //预测服务端返回的数据类型
							success: function(data) { //请求成功的回调
								layer.msg('提交申请成功！', {
									icon: 1,
									btn: ['知道了']
								}, function() {
									//知道了触发的事件
									location.reload();
								});
							},
							error: function() { //请求失败的回调
								layer.msg('发生了未知错误！', {
									icon: 2
								});
							}
						});
					}
				});
			});
			//]]>
		</script>

	</body>

</html>